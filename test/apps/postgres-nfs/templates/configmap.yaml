apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "postgres-nfs.fullname" . }}-init
  labels:
    {{- include "postgres-nfs.labels" . | nindent 4 }}
data:
  01-init.sql: |
    -- Create demo tables and data
    CREATE TABLE IF NOT EXISTS demo_data (
        id SERIAL PRIMARY KEY,
        name VARCHAR(100) NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        storage_info TEXT DEFAULT 'NFS Storage Demo'
    );
    
    INSERT INTO demo_data (name) VALUES 
        ('K3s Cluster Demo'),
        ('NFS Storage Test'),
        ('PostgreSQL on Kubernetes'),
        ('Persistent Volume Demo')
    ON CONFLICT DO NOTHING;
    
    CREATE TABLE IF NOT EXISTS storage_test (
        id SERIAL PRIMARY KEY,
        test_name VARCHAR(50),
        test_result TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
    
    INSERT INTO storage_test (test_name, test_result) VALUES
        ('NFS Mount', 'Successfully mounted NFS volume'),
        ('Data Persistence', 'Data persists across pod restarts'),
        ('Storage Class', 'Using nfs-client storage class')
    ON CONFLICT DO NOTHING;